<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Exploratory analysis on training set informations.">

<title>Exploration Data Analysis – steel_segmentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ac0578e1f87f273c3fa40b04908a6ea7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Exploration Data Analysis – steel_segmentation">
<meta property="og:description" content="Exploratory analysis on training set informations.">
<meta property="og:image" content="https://marcomatteo.github.io/steel_segmentation/01_eda_files/figure-html/cell-24-output-1.svg">
<meta property="og:site_name" content="steel_segmentation">
<meta name="twitter:title" content="Exploration Data Analysis – steel_segmentation">
<meta name="twitter:description" content="Exploratory analysis on training set informations.">
<meta name="twitter:image" content="https://marcomatteo.github.io/steel_segmentation/01_eda_files/figure-html/cell-24-output-1.svg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">steel_segmentation</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Exploration Data Analysis</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#seed_everything" id="toc-seed_everything" class="nav-link active" data-scroll-target="#seed_everything">seed_everything</a></li>
  <li><a href="#data-structure" id="toc-data-structure" class="nav-link" data-scroll-target="#data-structure">Data structure</a>
  <ul class="collapse">
  <li><a href="#print_competition_data" id="toc-print_competition_data" class="nav-link" data-scroll-target="#print_competition_data">print_competition_data</a></li>
  </ul></li>
  <li><a href="#training-data" id="toc-training-data" class="nav-link" data-scroll-target="#training-data">Training data</a>
  <ul class="collapse">
  <li><a href="#get_train_df" id="toc-get_train_df" class="nav-link" data-scroll-target="#get_train_df">get_train_df</a></li>
  <li><a href="#get_train_pivot" id="toc-get_train_pivot" class="nav-link" data-scroll-target="#get_train_pivot">get_train_pivot</a></li>
  <li><a href="#hard-negatives-with-patterns" id="toc-hard-negatives-with-patterns" class="nav-link" data-scroll-target="#hard-negatives-with-patterns">Hard negatives with patterns</a></li>
  <li><a href="#count_pct" id="toc-count_pct" class="nav-link" data-scroll-target="#count_pct">count_pct</a></li>
  </ul></li>
  <li><a href="#train-transforms" id="toc-train-transforms" class="nav-link" data-scroll-target="#train-transforms">Train transforms</a>
  <ul class="collapse">
  <li><a href="#pivot-rle-encodings" id="toc-pivot-rle-encodings" class="nav-link" data-scroll-target="#pivot-rle-encodings">Pivot RLE encodings</a></li>
  <li><a href="#multi-class-defects" id="toc-multi-class-defects" class="nav-link" data-scroll-target="#multi-class-defects">Multi class defects</a></li>
  <li><a href="#get_classification_df" id="toc-get_classification_df" class="nav-link" data-scroll-target="#get_classification_df">get_classification_df</a></li>
  </ul></li>
  <li><a href="#test-data" id="toc-test-data" class="nav-link" data-scroll-target="#test-data">Test data</a></li>
  <li><a href="#class-defects" id="toc-class-defects" class="nav-link" data-scroll-target="#class-defects">Class Defects</a>
  <ul class="collapse">
  <li><a href="#rle2mask" id="toc-rle2mask" class="nav-link" data-scroll-target="#rle2mask">rle2mask</a></li>
  <li><a href="#make_mask" id="toc-make_mask" class="nav-link" data-scroll-target="#make_mask">make_mask</a></li>
  <li><a href="#mask2rle" id="toc-mask2rle" class="nav-link" data-scroll-target="#mask2rle">mask2rle</a></li>
  <li><a href="#plot_mask_image" id="toc-plot_mask_image" class="nav-link" data-scroll-target="#plot_mask_image">plot_mask_image</a></li>
  <li><a href="#plot_defected_image" id="toc-plot_defected_image" class="nav-link" data-scroll-target="#plot_defected_image">plot_defected_image</a></li>
  <li><a href="#get_random_idx" id="toc-get_random_idx" class="nav-link" data-scroll-target="#get_random_idx">get_random_idx</a></li>
  </ul></li>
  <li><a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots">Plots</a>
  <ul class="collapse">
  <li><a href="#show_defects" id="toc-show_defects" class="nav-link" data-scroll-target="#show_defects">show_defects</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="eda.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploration Data Analysis</h1>
</div>

<div>
  <div class="description">
    Exploratory analysis on training set informations.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="cell-6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fastai</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fastai.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.8.4</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L24" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="seed_everything" class="level3">
<h3 class="anchored" data-anchor-id="seed_everything">seed_everything</h3>
<blockquote class="blockquote">
<pre><code> seed_everything (seed=69)</code></pre>
</blockquote>
<p><em>Seeds <code>random</code>, <code>os.environ["PYTHONHASHSEED"]</code>, <code>numpy</code>, <code>torch.cuda</code> and <code>torch.backends</code>.</em></p>
</section>
<section id="data-structure" class="level2">
<h2 class="anchored" data-anchor-id="data-structure">Data structure</h2>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L37" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="print_competition_data" class="level3">
<h3 class="anchored" data-anchor-id="print_competition_data">print_competition_data</h3>
<blockquote class="blockquote">
<pre><code> print_competition_data (p:pathlib.Path)</code></pre>
</blockquote>
<div id="cell-10" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:230,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809525756,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> Path(<span class="st">"../data/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>path</code> variable is a <code>os.pathlib.Path</code> object that points to the competition data.</p>
<p>To print all the files this directory use the <a href="https://marcomatteo.github.io/steel_segmentation/eda.html#print_competition_data"><code>print_competition_data</code></a> function.</p>
<div id="cell-12" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:14,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809528202,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="fc622050-c991-4b17-b99f-430b331441e3" data-execution_count="12">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>print_competition_data(path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>..\data\hard_negatives_patterns.txt
..\data\predictions
..\data\sample_submission.csv
..\data\submissions
..\data\test_images
..\data\train.csv
..\data\train_images</code></pre>
</div>
</div>
<p>The competition files in detail:</p>
<ul>
<li><strong>train_images/</strong> - folder of training images (12.5k images)</li>
<li><strong>test_images/</strong> - folder of test images to segment and classify (5506 images)</li>
<li><strong>train.csv</strong> - training annotations which provide segments for defects (<code>ClassId = [1, 2, 3, 4]</code>)</li>
<li><strong>sample_submission.csv</strong> - a sample submission file in the correct format; note, each <code>ImageId</code> 4 rows, one for each of the 4 defect classes</li>
</ul>
<div id="cell-14" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:669,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809594031,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>train_path <span class="op">=</span> path<span class="op">/</span><span class="st">"train_images"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>test_path <span class="op">=</span> path<span class="op">/</span><span class="st">"test_images"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>train_pfiles <span class="op">=</span> get_image_files(train_path)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>test_pfiles <span class="op">=</span> get_image_files(test_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="training-data" class="level2">
<h2 class="anchored" data-anchor-id="training-data">Training data</h2>
<p>The training data includes:</p>
<ul>
<li><p>faulty images: images that have at least one defect</p></li>
<li><p>hard negative images: images with no defects</p></li>
</ul>
<div id="cell-17" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:310,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809596144,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="57c4739a-2464-4b3c-8423-00252465bfb3" data-execution_count="14">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>train_pfiles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(#12568) [Path('../data/train_images/0002cc93b.jpg'),Path('../data/train_images/00031f466.jpg'),Path('../data/train_images/000418bfc.jpg'),Path('../data/train_images/000789191.jpg'),Path('../data/train_images/0007a71bf.jpg'),Path('../data/train_images/000a4bcdd.jpg'),Path('../data/train_images/000f6bf48.jpg'),Path('../data/train_images/0014fce06.jpg'),Path('../data/train_images/001982b08.jpg'),Path('../data/train_images/001d1b355.jpg')...]</code></pre>
</div>
</div>
<p>The <a href="https://marcomatteo.github.io/steel_segmentation/eda.html#get_train_df"><code>get_train_df</code></a> function returns the DataFrame from the <code>train.csv</code> file, only faulty image names if <code>only_faulty</code>, with the training images metadata: - <strong>ImageId</strong>: image name</p>
<ul>
<li><p><strong>ClassId</strong>: the class type</p></li>
<li><p><strong>EncodedPixels</strong>: the encoded pixels follows a run-length encoding rule, a sequence of pair values that contains a start position and a run length with the space as the delimiter. E.g. <code>1 3 10 5</code> means pixels <code>(1,2,3)</code> and <code>(10,11,12,13,14)</code>.</p></li>
</ul>
<p>Each Image may have no defects, a single defect, or multiple defects.</p>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L61" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_train_df" class="level3">
<h3 class="anchored" data-anchor-id="get_train_df">get_train_df</h3>
<blockquote class="blockquote">
<pre><code> get_train_df (path, only_faulty=False, pivot=False, hard_negatives=False)</code></pre>
</blockquote>
<p><em>Get training DataFrame with all the images in data/train_images. Returns only the faulty images if <code>only_faulty</code>.</em></p>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L42" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_train_pivot" class="level3">
<h3 class="anchored" data-anchor-id="get_train_pivot">get_train_pivot</h3>
<blockquote class="blockquote">
<pre><code> get_train_pivot (df)</code></pre>
</blockquote>
<p><em>Summarize the training csv with ClassId as columns and values EncodedPixels</em></p>
</section>
<section id="hard-negatives-with-patterns" class="level3">
<h3 class="anchored" data-anchor-id="hard-negatives-with-patterns">Hard negatives with patterns</h3>
<div id="cell-22" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:624,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809603121,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hard_neg_patterns <span class="op">=</span> pd.read_csv(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    path<span class="op">/</span><span class="st">"hard_negatives_patterns.txt"</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"ImageId"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:16,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809603123,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="e946e288-6c8b-48dc-bcc9-7b23de08973d" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hard_neg_patterns.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ImageId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>000789191.jpg</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>00d7ae946.jpg</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01b237ab8.jpg</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01d590c5f.jpg</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01e501f99.jpg</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In <code>hard_neg_patterns</code> there are the <code>ImageId</code>s of training images with some patterns (from this <a href="https://www.kaggle.com/ateplyuk/detector-steels-with-texture/data">kernel</a>).</p>
<div id="cell-25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:2171,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605282,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> get_train_df(path, only_faulty<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">isinstance</span>(train, pd.DataFrame)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>train_faulty <span class="op">=</span> train.loc[train[<span class="st">"status"</span>]<span class="op">==</span><span class="st">"faulty"</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> train.ImageId_ClassId.duplicated().<span class="bu">any</span>(), <span class="st">"Found ImageId_ClassId duplicates"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:76,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605283,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="7e614d4e-b19b-4d3e-a75b-124a1ac9c891" data-execution_count="19">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>train.describe(include<span class="op">=</span><span class="st">'all'</span>)[:<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th">EncodedPixels</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">ImageId_ClassId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>12997</td>
<td>12997.0</td>
<td>12997.0</td>
<td>12997</td>
<td>12997</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>12568</td>
<td>NaN</td>
<td>7096.0</td>
<td>2</td>
<td>12997</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>ef24da2ba.jpg</td>
<td>NaN</td>
<td>-1.0</td>
<td>faulty</td>
<td>0002cc93b.jpg_1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>3</td>
<td>NaN</td>
<td>5902.0</td>
<td>7095</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-27" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:72,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605286,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="188e5a0c-6fae-41bc-ac75-f644937cb35c" data-execution_count="20">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train.shape)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>train.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(12997, 5)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th">EncodedPixels</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">ImageId_ClassId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0002cc93b.jpg</td>
<td>1</td>
<td>29102 12 29346 24 29602 24 29858 24 30114 24 30370 24 30626 24 30882 24 31139 23 31395 23 31651 23 31907 23 32163 23 32419 23 32675 23 77918 27 78174 55 78429 60 78685 64 78941 68 79197 72 79452 77 79708 81 79964 85 80220 89 80475 94 80731 98 80987 102 81242 105 81498 105 81754 104 82010 104 82265 105 82521 31 82556 69 82779 27 82818 63 83038 22 83080 57 83297 17 83342 50 83555 13 83604 44 83814 8 83866 37 84073 3 84128 31 84390 25 84652 18 84918 8 85239 10 85476 29 85714 47 85960 57 86216 57 86471 58 86727 58 86983 58 87238 59 87494 59 87750 59 88005 60 88261 60 88517 60 88772 61 89028 53...</td>
<td>faulty</td>
<td>0002cc93b.jpg_1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>00031f466.jpg</td>
<td>0</td>
<td>-1</td>
<td>no_faulty</td>
<td>00031f466.jpg_0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>missing_imgs <span class="op">=</span> train[<span class="st">"ImageId"</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="kw">not</span> ((path<span class="op">/</span><span class="st">"train_images"</span><span class="op">/</span><span class="bu">str</span>(x)).is_file()))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(missing_imgs.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0</code></pre>
</div>
</div>
<div id="cell-29" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:67,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605288,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="6518c85b-5b24-4e73-c2c2-51cd8a3af781" data-execution_count="22">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_faulty.shape)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>train_faulty.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(7095, 5)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th">EncodedPixels</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">ImageId_ClassId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0002cc93b.jpg</td>
<td>1</td>
<td>29102 12 29346 24 29602 24 29858 24 30114 24 30370 24 30626 24 30882 24 31139 23 31395 23 31651 23 31907 23 32163 23 32419 23 32675 23 77918 27 78174 55 78429 60 78685 64 78941 68 79197 72 79452 77 79708 81 79964 85 80220 89 80475 94 80731 98 80987 102 81242 105 81498 105 81754 104 82010 104 82265 105 82521 31 82556 69 82779 27 82818 63 83038 22 83080 57 83297 17 83342 50 83555 13 83604 44 83814 8 83866 37 84073 3 84128 31 84390 25 84652 18 84918 8 85239 10 85476 29 85714 47 85960 57 86216 57 86471 58 86727 58 86983 58 87238 59 87494 59 87750 59 88005 60 88261 60 88517 60 88772 61 89028 53...</td>
<td>faulty</td>
<td>0002cc93b.jpg_1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0007a71bf.jpg</td>
<td>3</td>
<td>18661 28 18863 82 19091 110 19347 110 19603 110 19859 110 20115 110 20371 110 20627 110 20883 110 21139 110 21395 110 21651 110 21962 55 293125 251 293381 251 293637 251 293893 251 294149 251 294405 251 294661 251 294917 251 295173 251 295429 251 295685 251 295941 251 296197 251 296453 251 296709 251 296965 251 297221 251 297477 251 297733 251 297989 251 298245 251 298564 188 298945 63</td>
<td>faulty</td>
<td>0007a71bf.jpg_3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L102" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="count_pct" class="level3">
<h3 class="anchored" data-anchor-id="count_pct">count_pct</h3>
<blockquote class="blockquote">
<pre><code> count_pct (df, column='ClassId')</code></pre>
</blockquote>
<p><em>Returns a <code>pandas.DataFrame</code> with count and frequencies stats for <code>column</code>.</em></p>
<p>The <code>ClassId</code> column values from <code>train</code> are:</p>
<div id="cell-32" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:52,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605294,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="924f3003-f971-4e65-829b-cb322d1b8a4d" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>class_count <span class="op">=</span> count_pct(train)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>class_count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5902</td>
<td>0.454105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>897</td>
<td>0.069016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>247</td>
<td>0.019004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5150</td>
<td>0.396245</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>801</td>
<td>0.061630</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-33" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:699,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605946,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="f95965cc-b933-45bf-e446-124a008e4125" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>class_count[<span class="st">"num"</span>].plot.bar(title<span class="op">=</span><span class="st">"Defects by ClassId count"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-24-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Images have at least one defect and there’s a small number of images with two or three defects.</p>
<div id="cell-35" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:34,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605948,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="c726db2c-cd2c-46c1-f667-dfb1b74f70e9" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> train_faulty[<span class="st">"ImageId"</span>].value_counts()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>hist_counts, _ <span class="op">=</span> np.histogram(counts.values, bins<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>nums <span class="op">=</span> [<span class="st">'1'</span>, <span class="st">'2'</span>, <span class="st">'3'</span>]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>nums, height<span class="op">=</span>hist_counts)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Num of defects per images"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>{i<span class="op">+</span><span class="dv">1</span>: c <span class="cf">for</span> i, c <span class="kw">in</span> <span class="bu">enumerate</span>(hist_counts)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-25-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>{1: 6239, 2: 425, 3: 2}</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:33,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809605955,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="1754e0a6-e881-4848-eb94-643721723209" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>unique_imgs <span class="op">=</span> train_faulty.describe(include<span class="op">=</span><span class="st">'all'</span>)[<span class="st">"ImageId"</span>].T[:<span class="dv">2</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>unique_imgs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>count     7095
unique    6666
Name: ImageId, dtype: object</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:291,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809606219,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="951d63b5-1521-4736-9825-58f06986a7a8" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="fl">6.5</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Count imgs"</span>, pad<span class="op">=</span><span class="dv">30</span>, fontdict<span class="op">=</span>{<span class="st">'fontsize'</span>: <span class="dv">14</span>})</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ax.xaxis.tick_top()  <span class="co"># Display x-axis ticks on top</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    train[[<span class="st">'ImageId'</span>, <span class="st">'status'</span>]]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    .drop_duplicates()</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    .status.value_counts().iloc[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    .plot.barh(table<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-27-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="train-transforms" class="level2">
<h2 class="anchored" data-anchor-id="train-transforms">Train transforms</h2>
<p>Loading the images for models requires some transformations to the DataFrames.</p>
<section id="pivot-rle-encodings" class="level3">
<h3 class="anchored" data-anchor-id="pivot-rle-encodings">Pivot RLE encodings</h3>
<p>The <a href="https://marcomatteo.github.io/steel_segmentation/eda.html#get_train_pivot"><code>get_train_pivot</code></a> is the pivoted version of <code>df</code>. All the images are in the index, for each image the <code>ClassId</code> encoding values are in the columns.</p>
<div id="cell-42" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>train_pivot <span class="op">=</span> get_train_df(path, pivot<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-43" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:22,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809621406,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="cb57afcb-1e2b-4135-8f71-8ac83832e3a9" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>train_pivot.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">ClassIds</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0002cc93b.jpg</td>
<td>NaN</td>
<td>29102 12 29346 24 29602 24 29858 24 30114 24 30370 24 30626 24 30882 24 31139 23 31395 23 31651 23 31907 23 32163 23 32419 23 32675 23 77918 27 78174 55 78429 60 78685 64 78941 68 79197 72 79452 77 79708 81 79964 85 80220 89 80475 94 80731 98 80987 102 81242 105 81498 105 81754 104 82010 104 82265 105 82521 31 82556 69 82779 27 82818 63 83038 22 83080 57 83297 17 83342 50 83555 13 83604 44 83814 8 83866 37 84073 3 84128 31 84390 25 84652 18 84918 8 85239 10 85476 29 85714 47 85960 57 86216 57 86471 58 86727 58 86983 58 87238 59 87494 59 87750 59 88005 60 88261 60 88517 60 88772 61 89028 53...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">00031f466.jpg</td>
<td>-1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-44" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:17,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809621407,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="a20d0d26-ee39-433d-9dab-727f941bac8b" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>count_pct(train_pivot, column<span class="op">=</span><span class="st">'n'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>12141</td>
<td>0.966025</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>425</td>
<td>0.033816</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>0.000159</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>count_pct(train_pivot, column<span class="op">=</span><span class="st">'ClassIds'</span>).sort_values(<span class="st">"freq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ClassIds</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2 4</td>
<td>1</td>
<td>0.000080</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1 2 3</td>
<td>2</td>
<td>0.000159</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2 3</td>
<td>14</td>
<td>0.001114</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1 2</td>
<td>35</td>
<td>0.002785</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1 3</td>
<td>91</td>
<td>0.007241</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>195</td>
<td>0.015516</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3 4</td>
<td>284</td>
<td>0.022597</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>516</td>
<td>0.041057</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>769</td>
<td>0.061187</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4759</td>
<td>0.378660</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5902</td>
<td>0.469605</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="multi-class-defects" class="level3">
<h3 class="anchored" data-anchor-id="multi-class-defects">Multi class defects</h3>
<p>The <a href="https://marcomatteo.github.io/steel_segmentation/eda.html#get_classification_df"><code>get_classification_df</code></a> allows to build a DataFrame to classification models. In <code>ClassId_multi</code> are listed the <code>ClassId</code>s separated by a space.</p>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L111" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_classification_df" class="level3">
<h3 class="anchored" data-anchor-id="get_classification_df">get_classification_df</h3>
<blockquote class="blockquote">
<pre><code> get_classification_df (df:pandas.core.frame.DataFrame)</code></pre>
</blockquote>
<p><em>Get the DataFrame for the multiclass classification model</em></p>
<div id="cell-49" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809626520,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="5e27fe87-694f-4f25-f135-3d85c2d4d303" data-execution_count="34">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>train_multi <span class="op">=</span> get_classification_df(train)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>train_multi.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th">ClassId_multi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0002cc93b.jpg</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>00031f466.jpg</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>000418bfc.jpg</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>000789191.jpg</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0007a71bf.jpg</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-50" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:19,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809626522,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="f08a8134-e7ef-4b53-9342-3bedcd64b9a7" data-execution_count="35">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>count_pct(train_multi, column<span class="op">=</span><span class="st">'ClassId_multi'</span>).sort_values(<span class="st">"freq"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ClassId_multi</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5902</td>
<td>0.469605</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4759</td>
<td>0.378660</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>769</td>
<td>0.061187</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>516</td>
<td>0.041057</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3 4</td>
<td>284</td>
<td>0.022597</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>195</td>
<td>0.015516</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1 3</td>
<td>91</td>
<td>0.007241</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1 2</td>
<td>35</td>
<td>0.002785</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2 3</td>
<td>14</td>
<td>0.001114</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1 2 3</td>
<td>2</td>
<td>0.000159</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2 4</td>
<td>1</td>
<td>0.000080</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-51" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:16,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809626523,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="750b8a2f-978e-4ba9-bad3-7d3ed6a85267" data-execution_count="36">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>train_multi.describe(include<span class="op">=</span><span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ClassId</th>
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th">ClassId_multi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>12568</td>
<td>12568</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>12568</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>0002cc93b.jpg</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>1</td>
<td>5902</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="test-data" class="level2">
<h2 class="anchored" data-anchor-id="test-data">Test data</h2>
<div id="cell-53" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:310,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809635436,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="cfc7acb5-92e7-4fee-81a7-c75bcff7d54d" data-execution_count="37">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>test_pfiles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>(#5506) [Path('../data/test_images/0000f269f.jpg'),Path('../data/test_images/000ccc2ac.jpg'),Path('../data/test_images/002451917.jpg'),Path('../data/test_images/003c5da97.jpg'),Path('../data/test_images/0042e163f.jpg'),Path('../data/test_images/004f40c73.jpg'),Path('../data/test_images/00513039a.jpg'),Path('../data/test_images/006f39c41.jpg'),Path('../data/test_images/008725cbc.jpg'),Path('../data/test_images/0098ca44e.jpg')...]</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:371,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627809636729,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="00150bf0-cfdb-4c84-8adb-6c7e47e2d9b5" data-execution_count="38">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.read_csv(path <span class="op">/</span> <span class="st">'sample_submission.csv'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>test_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ImageId</th>
<th data-quarto-table-cell-role="th">EncodedPixels</th>
<th data-quarto-table-cell-role="th">ClassId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0000f269f.jpg</td>
<td>1 409600</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>000ccc2ac.jpg</td>
<td>1 409600</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>002451917.jpg</td>
<td>1 409600</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>003c5da97.jpg</td>
<td>1 409600</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0042e163f.jpg</td>
<td>1 409600</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="class-defects" class="level2">
<h2 class="anchored" data-anchor-id="class-defects">Class Defects</h2>
<div id="cell-56" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> old_rle2mask(rle: <span class="bu">str</span>, value: <span class="bu">int</span>, shape):</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">    From a RLE encoded pixels returns a mask</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">    with `value` for defected pixels</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">    (e.g. `value`=1 so 1 -&gt; defected, 0 -&gt; groundtruth)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and `shape` as tuple (height, width).</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(shape) <span class="op">==</span> <span class="dv">2</span>, <span class="st">"The shape must be (height, width)"</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(shape[<span class="dv">0</span>], <span class="bu">int</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(shape[<span class="dv">1</span>], <span class="bu">int</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> shape</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.zeros(h <span class="op">*</span> w, dtype<span class="op">=</span>np.uint8)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    rle <span class="op">=</span> rle.split(<span class="st">" "</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, rle[<span class="dv">0</span>::<span class="dv">2</span>])</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, rle[<span class="dv">1</span>::<span class="dv">2</span>])</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pos, le <span class="kw">in</span> <span class="bu">zip</span>(positions, length):</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        mask[pos:(pos <span class="op">+</span> le)] <span class="op">=</span> value</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mask.reshape(h, w, order<span class="op">=</span><span class="st">'F'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L137" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="rle2mask" class="level3">
<h3 class="anchored" data-anchor-id="rle2mask">rle2mask</h3>
<blockquote class="blockquote">
<pre><code> rle2mask (rle, value=1, shape=(256, 1600))</code></pre>
</blockquote>
<p><em>mask_rle: run-length as string formated (start length) shape: (width,height) of array to return Returns numpy array, 1 - mask, 0 - background Source: https://www.kaggle.com/paulorzp/rle-functions-run-lenght-encode-decode</em></p>
<div id="cell-58" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>item <span class="op">=</span> train_faulty.iloc[<span class="dv">1</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>item_class_id <span class="op">=</span> item[<span class="st">"ClassId"</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>item_rle <span class="op">=</span> item[<span class="st">"EncodedPixels"</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>item_rle[:<span class="dv">50</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>'18661 28 18863 82 19091 110 19347 110 19603 110 19'</code></pre>
</div>
</div>
<div id="cell-59" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> item_rle.split()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>how_many_values <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>pixels <span class="op">=</span> s[<span class="dv">0</span>:][::<span class="dv">2</span>]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>lengths <span class="op">=</span> s[<span class="dv">1</span>:][::<span class="dv">2</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>(pixels[:how_many_values], lengths[:how_many_values])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>(['18661',
  '18863',
  '19091',
  '19347',
  '19603',
  '19859',
  '20115',
  '20371',
  '20627',
  '20883'],
 ['28', '82', '110', '110', '110', '110', '110', '110', '110', '110'])</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>starts, lengths <span class="op">=</span> [np.asarray(x, dtype<span class="op">=</span><span class="bu">int</span>) <span class="cf">for</span> x <span class="kw">in</span> (s[<span class="dv">0</span>:][::<span class="dv">2</span>], s[<span class="dv">1</span>:][::<span class="dv">2</span>])]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>starts <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>starts, lengths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>(array([ 18660,  18862,  19090,  19346,  19602,  19858,  20114,  20370,
         20626,  20882,  21138,  21394,  21650,  21961, 293124, 293380,
        293636, 293892, 294148, 294404, 294660, 294916, 295172, 295428,
        295684, 295940, 296196, 296452, 296708, 296964, 297220, 297476,
        297732, 297988, 298244, 298563, 298944]),
 array([ 28,  82, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110,
         55, 251, 251, 251, 251, 251, 251, 251, 251, 251, 251, 251, 251,
        251, 251, 251, 251, 251, 251, 251, 251, 251, 188,  63]))</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ends <span class="op">=</span> starts <span class="op">+</span> lengths</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ends</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>array([ 18688,  18944,  19200,  19456,  19712,  19968,  20224,  20480,
        20736,  20992,  21248,  21504,  21760,  22016, 293375, 293631,
       293887, 294143, 294399, 294655, 294911, 295167, 295423, 295679,
       295935, 296191, 296447, 296703, 296959, 297215, 297471, 297727,
       297983, 298239, 298495, 298751, 299007])</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mask_img <span class="op">=</span> np.zeros(<span class="dv">256</span><span class="op">*</span><span class="dv">1600</span>, dtype<span class="op">=</span>np.uint8)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lo, hi <span class="kw">in</span> <span class="bu">zip</span>(starts, ends):</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    mask_img[lo:hi] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>mask_img[<span class="dv">18658</span>:<span class="dv">18698</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>array([0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], dtype=uint8)</code></pre>
</div>
</div>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>item_mask <span class="op">=</span> rle2mask(item_rle, <span class="dv">1</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>show_image(item_mask, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L154" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="make_mask" class="level3">
<h3 class="anchored" data-anchor-id="make_mask">make_mask</h3>
<blockquote class="blockquote">
<pre><code> make_mask (item, df, flatten=False)</code></pre>
</blockquote>
<p>*Given an item as: - row index [int] or - ImageId [str] or - file [Path] or - query [pd.Series],</p>
<p>returns the image_item and mask with two types of shapes: - (256, 1600) if <code>flatten</code>, - (256, 1600, 4) if not <code>flatten</code>,*</p>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L192" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mask2rle" class="level3">
<h3 class="anchored" data-anchor-id="mask2rle">mask2rle</h3>
<blockquote class="blockquote">
<pre><code> mask2rle (mask)</code></pre>
</blockquote>
<p>*Efficient implementation of mask2rle, from <span class="citation" data-cites="paulorzp">@paulorzp</span></p>
<p>img: numpy array, 1 - mask, 0 - background Returns run length as string formated Source: https://www.kaggle.com/xhlulu/efficient-mask2rle*</p>
<div id="cell-66" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> rle2mask(item_rle)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>rle <span class="op">=</span> mask2rle(mask)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>rle[:<span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>'18661 28 18863 82 19091 110 19347 110 19603 110 19859 110 20115 110 20371 110 20627 110 20883 110 21'</code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>test_eq(rle, item_rle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L207" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_mask_image" class="level3">
<h3 class="anchored" data-anchor-id="plot_mask_image">plot_mask_image</h3>
<blockquote class="blockquote">
<pre><code> plot_mask_image (name:str, img:&lt;built-infunctionarray&gt;, mask:&lt;built-
                  infunctionarray&gt;)</code></pre>
</blockquote>
<p><em>Plot a np.array image and mask with contours.</em></p>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L223" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_defected_image" class="level3">
<h3 class="anchored" data-anchor-id="plot_defected_image">plot_defected_image</h3>
<blockquote class="blockquote">
<pre><code> plot_defected_image (img_path:pathlib.Path,
                      df:pandas.core.frame.DataFrame, class_id=None)</code></pre>
</blockquote>
<p><em>Plot a <code>img_path</code> Path image from the training folder with contours.</em></p>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L242" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_random_idx" class="level3">
<h3 class="anchored" data-anchor-id="get_random_idx">get_random_idx</h3>
<blockquote class="blockquote">
<pre><code> get_random_idx (n:int)</code></pre>
</blockquote>
<p><em>Return a random sequence of size <code>n</code>.</em></p>
</section>
</section>
<section id="plots" class="level2">
<h2 class="anchored" data-anchor-id="plots">Plots</h2>
<hr>
<p><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/blob/master/steel_segmentation/utils.py#L250" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="show_defects" class="level3">
<h3 class="anchored" data-anchor-id="show_defects">show_defects</h3>
<blockquote class="blockquote">
<pre><code> show_defects (path, df, class_id=None, n=20, only_defects=True,
               multi_defects=False)</code></pre>
</blockquote>
<p><em>Plot multiple images. Attributes: <code>path</code>: [Path] <code>df</code>: [pd.DataFrame] only train_pivot <code>class_id</code>: [str or int] select a type of defect otherwise plot all kinds; <code>n</code>: select the number of images to plot; <code>only_defects</code> [bool, default True]: if False it shows even the no faulty images; <code>multi_defects</code> [bool, default False]: if True it shows imgs with multi defects.</em></p>
<div id="cell-73" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;elapsed&quot;:10932,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1627812536065,&quot;user&quot;:{&quot;displayName&quot;:&quot;Marco Matteo Buzzulini&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;16413977196805810676&quot;},&quot;user_tz&quot;:-120}}" data-outputid="b28388fa-c5a8-4ead-e9f3-04e16cf8e71c" data-scrolled="false" data-execution_count="44">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>show_defects(path, train_pivot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-3.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-4.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-5.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-6.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-7.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-8.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-9.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-10.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-11.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-12.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-13.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-14.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-15.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-16.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-17.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-18.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-19.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_eda_files/figure-html/cell-54-output-20.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/marcomatteo\.github\.io\/steel_segmentation\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>